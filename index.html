<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CREEK GENERATOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro&display=swap" rel="stylesheet">

    <style>
        html {
            /* background: url(assets/creek-background85.jpg); */
            background-color: black;
            background-repeat: no-repeat;
            background-size: auto;
            color: white;
            font-family: "Crimson Pro", serif;
            font-size: 24px;
            height: 100%;
            width: 100%;
            padding: 0;
            margin: 0;
        }

        button {
            background-color: black;
            color: grey;
            font-family: "Crimson Pro", serif;
            font-size: 0.75em;
            border: none;
        }

        .center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
            flex-direction: column;
            text-overflow: clip;
            white-space: nowrap;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .creek_text {
            color: white;
            font-family: 'Crimson Pro', serif;
            font-size: 24px;
        }

        .projector {
            padding-top: 20%;
            justify-content: center;
            align-items: center;
            display: flex;
            width: 100%;
            font-size: 1.25em;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="container">
        <div id="blinking_title">
            <div class="projector">THE CREEK GENERATOR</div>
        </div>
        <div id="hide_projector"></div>
        <div class="creek_text">
            <div id="creek"></div>
            <div id="poetic_interlude"></div>
        </div>
    </div>

    <div id="start_button" class="center">
        <button onclick="main()">CLICK TO BEGIN</button>
    </div>

</body>
<!-- 
<script>
    window.addEventListener('scroll', () => {
        console.log(window.scrollY); //scrolled from top
        console.log(window.innerHeight); //visible part of screen
    })
</script> -->

<script>
    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }

    var interval;
    (function titleFlicker() {
        var flickerSpeeds = [500, 1000, 250, 1000, 2000, 5000, 1000, 2000, 7000, 5000];
        flicker = flickerSpeeds[getRndInteger(0, 9)];
        index = 100;
        while (index > 0) {
            interval = setInterval(function () {
                if (!interval) return;
                var ele = document.getElementById("blinking_title");
                ele.style.visibility = (ele.style.visibility == 'hidden' ? '' : 'hidden');
            }, flicker);
            flicker = flickerSpeeds[getRndInteger(0, 7)];
            index--;
        }
    })()

    function hideProjector() {
        clearInterval(interval);
        interval = null;
        document.getElementById("blinking_title").remove();
        document.getElementById("start_button").remove();
    }

    async function main() {
        hideProjector();
        while (true) {
            var rand = getRndInteger(0, 10);
            if (rand % 2) {
                console.log("GENERATOR! ", rand);
                await beginGenerator();
            }
            else {
                console.log("INTERLUDE! ", rand);
                await beginInterlude();
            }
            // await delay(500);
        }
    }

    function delay(duration) {
        return new Promise(function (resolve, reject) {
            setTimeout(resolve, duration);
        });
    }

    async function beginGenerator() {
        return new Promise(async function (resolve, reject) {
            const creekElements = ["leaf", "sapling", "bark", "silt", "water", "soil",
                "faun", "deer", "spider", "ivy", "drosera", "bleedingheart", "roots",
                "bark", "flow", "web", "sap", "bee", "bramble", "shrub", "rot",
                "pine", "oak", "owl", "maple", "pollen", "stem", "leaf", "trunk",
                "silt", "geranium", "stick", "goldenrod", "foxglove", "aster",
                "beech", "ash", "elm", "fir", "hemlock", "hickory", "pine",
                "spruce", "thorn", "walnut", "willow", "fox", "squirrel", "bat",
                "hare", "mouse", "possum", "daggermoth", "tick", "orbweaver",
                "firefly", "fishingspider", "butterfly", "pebble", "petal",
                "mycelium", "inkycap", "detritus", "worm", "ant", "sand", "loam",
                "blacktrumpet", "falsemorel", "breeze", "tunnel"];

            var elementsDepth = creekElements.length;
            var creek = document.getElementById("creek");
            var landscape = 100;
            var currentLine = 0;
            var rand = getRndInteger(0, elementsDepth);
            console.log("REG LOGIC")
            var wordText = creekElements[rand] + " ";
            var lineWidth = (landscape / wordText.length);
            while (currentLine <= lineWidth) {
                var word = document.createElement("span");
                word.style.color = "grey";
                word.innerText = wordText;
                console.log('APPENDING ', word);
                creek.append(word);
                currentLine++;
                await delay(400);
            }
            console.log("IN IF FOR REG LOGIC");
            currentLine = 0;
            var lineBreak = document.createElement("br");
            creek.append(lineBreak);
            resolve();
        });
    }

    function beginInterlude() {
        return new Promise(async function (resolve, reject) {
            const interludeElements = ["in this place there is a generation",
                "a generating space in the clearing ",
                "marked by mirrors whose entrance",
                "for revenants to kneel and drink",
                "an obsidian well for commands to bubble up",
                "a plane for harvesting detritus",
                "a catacomb with planets tucked into the corners",
                "a current for conjecture in syrup.",
                "in this place there is a germination",
                "for coating the crevices of the tongue",
                "a ring of sound for injecting",
                "the earliest memories of possession",
                "peels back hardened rinds",
                "an ivory deer lurks in the trees",
                "a heart caves in on itself",
                "in this place there is a genome variation",
                "a generating space where lace wings untie and tie again",
                "metal vines choke plastic pipes",
                "crystal goblets during a storm",
                "rubies inject into the bloodstream",
                "free eyes roll around a cracked platter",
                "a match tossed into a slick mouth.",
                "in this place there is a generating space",
                "a lock breaks a generation",
                "a velvet barrette in tar",
                "a telescope twined in hair",
                "electrophilic luster dipped in blue black",
                "magnets filament my spine",
                "from my mouth a delicacy",
                "a gold fork pulls back my lips"];

            const vaultMessages = ["a crumpled pane a place for resonance",
                "a layer of toxic loam",
                "a generating space for collecting",
                "a knife opens petals",
                "ink pulls taffy loose from bone fractals.",
                "zebra mussels slice footsteps",
                "sugar lined spoons",
                "a glass heel",
                "pulls stitches during the storm",
                "a current generates a generation a linking",
                "a mirror deep topography."];
            var interludeDepth = interludeElements.length;
            var randInterlude = getRndInteger(0, interludeDepth);
            for (i = 0; i < 3; i++) {

                var creek = document.getElementById("creek");
                var landscape = 100;
                var interludeIndex = 0;

                console.log("RAND INDEX of interlude: ", randInterlude, interludeElements[randInterlude]);
                console.log("REG LOGIC")
                var interludeText = interludeElements[(randInterlude + i) % interludeDepth] + " ";
                var interludeArray = interludeText.split(" ");
                var interludeWidth = (interludeArray.length - 1);
                console.log("INT ARRAY ", interludeArray);
                console.log("INTERLUDE WIDTH: ", interludeWidth);
                while (interludeIndex < interludeWidth) {
                    var poemWord = document.createElement("span");
                    poemWord.innerText = (interludeArray[interludeIndex] + " ");
                    console.log('APPENDING ', poemWord + " ");
                    creek.append(poemWord);
                    interludeIndex++;
                    await delay(600);
                }
                console.log("IN IF FOR REG LOGIC");
                interludeIndex = 0;
                var lineBreak = document.createElement("br");
                creek.append(lineBreak);
            }
            resolve();
        });
    }
</script>

</html>