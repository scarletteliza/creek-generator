<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CREEK GENERATOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro&display=swap" rel="stylesheet">

    <style>
        html {
            background: url(assets/creek-background85.jpg);
            background-repeat: no-repeat;
            background-size: auto;
            color: white;
            font-family: "Crimson Pro", serif;
            font-size: 24px;
            height: 100%;
            width: 100%;
            padding: 0;
            margin: 0;
        }

        button {
            color: white;
            font-family: "Crimson Pro", serif;
            font-size: 1em;
            border: none;
        }

        .center {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
            flex-direction: column;
            text-overflow: clip;
            white-space: nowrap;
            overflow: hidden;
        }

        .creek_text {
            color: white;
            font-family: 'Crimson Pro', serif;
            font-size: 24px;
        }

        .projector {
            padding-top: 20%;
            justify-content: center;
            align-items: center;
            display: flex;
            width: 100%;
            font-size: 1.25em;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="container">
        <div id="blinking_title">
            <div class="projector">THE CREEK GENERATOR</div>
        </div>
        <div id="hide_projector"></div>
        <div class="creek_text">
            <div id="creek"></div>
            <div id="poetic_interlude"></div>
        </div>
    </div>

    <div id="start_button" class="center">
        <button onclick="main()">Click here to begin</button>
    </div>

</body>
<!-- 
<script>
    window.addEventListener('scroll', () => {
        console.log(window.scrollY); //scrolled from top
        console.log(window.innerHeight); //visible part of screen
    })
</script> -->

<script>
    function getRndInteger(min, max) {
        return Math.floor(Math.random() * (max - min)) + min;
    }
</script>

<script>
    var interval;
    (function titleFlicker() {
        var flickerSpeeds = [500, 1000, 250, 1000, 2000, 5000, 1000, 2000, 7000, 5000];
        flicker = flickerSpeeds[getRndInteger(0, 9)];
        index = 100;
        while (index > 0) {
            interval = setInterval(function () {
                if (!interval) return;
                var ele = document.getElementById("blinking_title");
                ele.style.visibility = (ele.style.visibility == 'hidden' ? '' : 'hidden');
            }, flicker);
            flicker = flickerSpeeds[getRndInteger(0, 7)];
            index--;
        }
    })()

    function hideProjector() {
        clearInterval(interval);
        interval = null;
        document.getElementById("blinking_title").remove();
        document.getElementById("start_button").remove();
    }

</script>

<script>
    function main() {
        hideProjector();
        setInterval(function () {
            var rand = getRndInteger(0, 10);
            console.log("RAND ", rand%2 == 0);
            if (rand % 2) {
                beginInterlude();
            }
            else {
                beginGenerator();
            }
        }, 10000)
    }

    function delay(duration) {
        return new Promise(function (resolve, reject) {
            setTimeout(resolve, duration);
        });
    }

    async function beginGenerator() {
        const creekElements = ["leaf", "sapling", "bark", "silt", "water", "soil",
            "faun", "deer", "spider", "ivy", "drosera", "bleedingheart", "roots",
            "bark", "flow", "web", "sap", "bee", "bramble", "shrub", "rot",
            "pine", "oak", "owl", "maple", "pollen", "stem", "leaf", "trunk",
            "silt", "geranium", "stick", "goldenrod", "foxglove", "aster",
            "beech", "ash", "elm", "fir", "hemlock", "hickory", "pine",
            "spruce", "thorn", "walnut", "willow", "fox", "squirrel", "bat",
            "hare", "mouse", "possum", "daggermoth", "tick", "orbweaver",
            "firefly", "fishingspider", "butterfly", "pebble", "petal",
            "mycelium", "inkycap", "detritus", "worm", "ant", "sand", "loam",
            "blacktrumpet", "falsemorel", "breeze", "tunnel"];

        var elementsDepth = creekElements.length;
        var creek = document.getElementById("creek");
        var landscape = 100;
        var currentLine = 0;
        var rand = getRndInteger(0, elementsDepth);
        console.log("REG LOGIC")
        var wordText = creekElements[rand] + " ";
        var lineWidth = (landscape / wordText.length);
        while (currentLine <= lineWidth) {
            var word = document.createElement("span");
            word.innerText = wordText;
            console.log('APPENDING ', word);
            creek.append(word);
            currentLine++;
            await delay(400);
        }
        console.log("IN IF FOR REG LOGIC");
        currentLine = 0;
        var lineBreak = document.createElement("br");
        creek.append(lineBreak);
    }
</script>

<script>
    function beginInterlude() {
        const interludeElements = ["in this place there is a generation",
            "a generating space in the clearing",
            "marked by mirrors whose entrance",
            "a crumpled pane a place for resonance"];

        // var elementsDepth = creekElements.length;
        var creekCreek = document.getElementById("creek");
        for (var i = 0; i < 4; i++) {
            var rand = getRndInteger(0, 4);
            var interludeLine = document.createElement("span");
            interludeLine.innerText = (interludeElements[rand] + " ");
            creekCreek.append(interludeLine);
            var line_Break = document.createElement("br");
            creekCreek.append(line_Break);
        }
    }
</script>

</html>